(()=>{"use strict";const e=window.wp.element,s=window.ReactJSXRuntime,t=({onSettingsClick:e})=>(0,s.jsxs)("div",{className:"sqt-header",children:[(0,s.jsx)("div",{className:"sqt-logo",children:(0,s.jsx)("svg",{width:"48",height:"48",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsxs)("g",{children:[(0,s.jsx)("path",{d:"m47.102 32.602c-8.1016 0-14.602 6.6016-14.602 14.602 0 8.1016 6.6016 14.602 14.602 14.602 8.1016 0 14.602-6.6016 14.602-14.602-0.003906-8.0039-6.5039-14.602-14.602-14.602z"}),(0,s.jsx)("path",{d:"m50.102 1.3984c-26.902 0-48.703 21.801-48.703 48.703 0 26.898 21.801 48.699 48.699 48.699 26.902 0 48.703-21.801 48.703-48.699 0-26.902-21.801-48.703-48.699-48.703zm23.699 73.703c-0.69922 0.69922-1.8008 1.1016-3 1.1016s-2.1992-0.39844-3-1.1016l-9.1992-9.1992-0.89844 0.5c-3.3008 1.8008-6.8984 2.8008-10.602 2.8008-12.102 0-21.898-9.8008-21.898-21.898 0-12.102 9.8008-21.898 21.898-21.898 12.102 0 21.898 9.8008 21.898 21.898 0 4.3008-1.1992 8.3984-3.6016 12l-0.60156 1 9.1016 9.1016c0.69922 0.80078 1.1992 1.8008 1.1992 2.8984-0.097656 0.99609-0.49609 1.9961-1.2969 2.7969z"})]})})}),(0,s.jsx)("div",{className:"sqt-title",children:(0,s.jsx)("h1",{children:"Search Query Tracker"})}),(0,s.jsx)("div",{className:"sqt-actions",children:(0,s.jsx)("button",{className:"sqt-settings-button",onClick:e,children:"Settings"})})]}),c=({searchQueries:t,searchClicks:c,maxCount:a,onRowClick:r})=>{const[n,l]=(0,e.useState)({}),[i,o]=(0,e.useState)(""),[d,h]=(0,e.useState)("search"),[u,j]=(0,e.useState)("desc");(0,e.useEffect)((()=>{const e=Object.entries(t).reduce(((e,[s,t])=>(s.toLowerCase().includes(i.toLowerCase())&&(e[s]=t),e)),{}),s=b(e,c,d,u);l(s)}),[t,c,i,d,u]);const x=e=>{d===e?j("desc"===u?"asc":"desc"):(h(e),j("desc"))},m=e=>d!==e?null:"desc"===u?"▼":"▲",p=e=>c[e]?Object.values(c[e]).reduce(((e,s)=>e+s),0):0,b=(e,s,t,c)=>{const a=Object.entries(e);return a.sort((([e,s],[a,r])=>{let n=0;switch(t){case"search":default:n=r-s;break;case"term":n=e.localeCompare(a);break;case"clicks":const t=p(e);n=p(a)-t}return"asc"===c?-n:n})),Object.fromEntries(a)};return(0,s.jsxs)("div",{className:"sqt-table-container",children:[(0,s.jsxs)("div",{className:"sqt-search-container",children:[(0,s.jsxs)("div",{className:"sqt-search-input",children:[(0,s.jsx)("input",{type:"text",value:i,onChange:e=>o(e.target.value),placeholder:"Search terms...","aria-label":"Search"}),i&&(0,s.jsx)("button",{className:"sqt-clear-button",onClick:()=>{o("")},children:"Clear"})]}),i&&(0,s.jsxs)("div",{className:"sqt-search-info",children:["Showing results for: ",(0,s.jsx)("strong",{children:i}),"(",Object.keys(n).length," results)"]}),i&&0===Object.keys(n).length&&(0,s.jsx)("div",{className:"sqt-no-results",children:(0,s.jsx)("p",{children:"No search queries found matching your filter."})})]}),(Object.keys(n).length>0||!i)&&(0,s.jsxs)("table",{className:"sqt-queries-table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{style:{width:"80px"},children:(0,s.jsxs)("button",{className:"sqt-sort-button",onClick:()=>x("search"),children:["Search ",m("search")]})}),(0,s.jsx)("th",{children:(0,s.jsxs)("button",{className:"sqt-sort-button",onClick:()=>x("term"),children:["Term ",m("term")]})}),(0,s.jsx)("th",{style:{width:"120px"},children:(0,s.jsxs)("button",{className:"sqt-sort-button",onClick:()=>x("clicks"),children:["Clicks ",m("clicks")]})})]})}),(0,s.jsx)("tbody",{children:Object.entries(n).map((([e,t])=>{const c=((e,s)=>{const t=a>0?s/a*100:0,c=p(e);return{percentage:t,hasClicks:c>0,totalClicks:c}})(e,t);return(0,s.jsxs)("tr",{className:c.hasClicks?"sqt-row-clickable":"",onClick:c.hasClicks?()=>r(e):void 0,style:{cursor:c.hasClicks?"pointer":"default"},children:[(0,s.jsx)("td",{children:t}),(0,s.jsx)("td",{children:(0,s.jsxs)("div",{className:"sqt-bar-chart",children:[(0,s.jsx)("div",{className:"sqt-bar",style:{width:`${c.percentage}%`}}),(0,s.jsx)("div",{className:"sqt-bar-label",children:(0,s.jsx)("span",{children:e})})]})}),(0,s.jsxs)("td",{children:[c.totalClicks,c.hasClicks&&(0,s.jsx)("span",{className:"view-links",children:"View →"})]})]},e)}))})]})]})},a=({isOpen:e,onClose:t,title:c,children:a})=>e?(0,s.jsx)("div",{className:"sqt-popup-wrapper",children:(0,s.jsxs)("div",{className:"sqt-popup-content",children:[(0,s.jsxs)("div",{className:"sqt-popup-header",children:[(0,s.jsx)("h2",{children:c}),(0,s.jsx)("button",{type:"button",className:"sqt-popup-close",onClick:t,"aria-label":"Close",children:"×"})]}),(0,s.jsx)("div",{className:"sqt-popup-body",children:a})]})}):null,r=({isOpen:t,onClose:c,onReset:r})=>{const[n,l]=(0,e.useState)(""),[i,o]=(0,e.useState)(!0);return(0,e.useEffect)((()=>{o("reset"!==n.toLowerCase())}),[n]),(0,s.jsxs)(a,{isOpen:t,onClose:c,title:"Plugin Settings",children:[(0,s.jsxs)("div",{className:"sqt-settings-section",children:[(0,s.jsx)("h3",{children:"Troubleshooting"}),(0,s.jsx)("p",{children:"To make things simple we have hardcoded search trigger."}),(0,s.jsxs)("p",{children:["Add class ",(0,s.jsx)("code",{children:".search-result-item"})," to the search result item."]})]}),(0,s.jsxs)("div",{className:"sqt-settings-section",children:[(0,s.jsx)("h3",{children:"Clear All Data"}),(0,s.jsx)("div",{className:"sqt-reset-description",children:(0,s.jsx)("p",{className:"sqt-warning",children:"This will permanently delete all search query data and click tracking information. This action cannot be undone."})}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"reset"===n.toLowerCase()&&(r(),l(""))},className:"sqt-reset-confirmation",children:[(0,s.jsxs)("div",{className:"sqt-form-row",children:[(0,s.jsx)("label",{htmlFor:"reset-confirmation",children:'Type "reset" to confirm:'}),(0,s.jsx)("input",{id:"reset-confirmation",type:"text",value:n,onChange:e=>l(e.target.value),placeholder:"reset"})]}),(0,s.jsx)("div",{className:"sqt-form-row",children:(0,s.jsx)("button",{type:"submit",className:"sqt-reset-button",disabled:i,children:"Clear All Data"})})]})]})]})},n=({isOpen:e,onClose:t,query:c,clickData:r})=>{const n=Object.entries(r).map((([e,s])=>({url:e,count:s}))).sort(((e,s)=>s.count-e.count));return(0,s.jsx)(a,{isOpen:e,onClose:t,title:`Clicked URLs for: "${c}"`,children:(0,s.jsx)("div",{className:"sqt-clicks-content",children:n.length>0?(0,s.jsxs)("table",{className:"sqt-clicks-table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"URL"}),(0,s.jsx)("th",{children:"Clicks"})]})}),(0,s.jsx)("tbody",{children:n.map((({url:e,count:t})=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:(0,s.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:e})}),(0,s.jsx)("td",{children:t})]},e)))})]}):(0,s.jsx)("div",{className:"sqt-no-clicks",children:(0,s.jsx)("p",{children:"No click data available for this search query."})})})})},l=()=>{const[a,l]=(0,e.useState)({}),[i,o]=(0,e.useState)({}),[d,h]=(0,e.useState)(0),[u,j]=(0,e.useState)(!0),[x,m]=(0,e.useState)(null),[p,b]=(0,e.useState)(null),[k,q]=(0,e.useState)("");(0,e.useEffect)((()=>{(async()=>{try{j(!0);const e=await(async()=>{try{const e=await fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"sqt_get_data",nonce:sqtData.nonce})});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const s=await e.json();if(s.success)return{searchQueries:s.data.searchQueries||{},searchClicks:s.data.searchClicks||{}};throw new Error(s.data||"Failed to fetch search data")}catch(e){throw console.error("Error fetching search data:",e),e}})();l(e.searchQueries||{}),o(e.searchClicks||{});let s=0;Object.values(e.searchQueries||{}).forEach((e=>{e>s&&(s=e)})),h(s),j(!1)}catch(e){m("Failed to load search data"),j(!1),console.error(e)}})()}),[]);const w=(e,s="")=>{b(e),s&&q(s)},C=()=>{b(null),q("")};return u&&0===Object.keys(a).length?(0,s.jsx)("div",{className:"sqt-loading",children:(0,s.jsx)("p",{children:"Loading search data..."})}):x?(0,s.jsx)("div",{className:"sqt-error",children:(0,s.jsx)("p",{children:x})}):(0,s.jsxs)("div",{className:"wrap",children:[(0,s.jsx)(t,{onSettingsClick:()=>w("settings")}),0===Object.keys(a).length?(0,s.jsx)("div",{className:"sqt-no-data",children:(0,s.jsx)("p",{children:"No search queries data available yet."})}):(0,s.jsx)(c,{searchQueries:a,searchClicks:i,maxCount:d,onRowClick:e=>w("clicks",e)}),(0,s.jsx)(r,{isOpen:"settings"===p,onClose:C,onReset:async()=>{try{j(!0),await fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"sqt_reset_data",nonce:sqtData.nonce})}),l({}),o({}),h(0),C(),j(!1)}catch(e){m("Failed to reset data"),j(!1),console.error(e)}}}),(0,s.jsx)(n,{isOpen:"clicks"===p,onClose:C,query:k,clickData:i[k]||{}})]})};document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("sqt-app");t&&(0,e.render)((0,s.jsx)(l,{}),t)}))})();