(()=>{"use strict";const e=window.wp.element,s=window.wp.components,t=window.ReactJSXRuntime,a=({onSettingsClick:e})=>(0,t.jsxs)("div",{className:"bg-white border-b border-gray-200 p-6 flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,t.jsx)("div",{className:"w-[36px] h-[36px]",children:(0,t.jsx)("svg",{viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsxs)("g",{children:[(0,t.jsx)("path",{d:"m47.102 32.602c-8.1016 0-14.602 6.6016-14.602 14.602 0 8.1016 6.6016 14.602 14.602 14.602 8.1016 0 14.602-6.6016 14.602-14.602-0.003906-8.0039-6.5039-14.602-14.602-14.602z"}),(0,t.jsx)("path",{d:"m50.102 1.3984c-26.902 0-48.703 21.801-48.703 48.703 0 26.898 21.801 48.699 48.699 48.699 26.902 0 48.703-21.801 48.703-48.699 0-26.902-21.801-48.703-48.699-48.703zm23.699 73.703c-0.69922 0.69922-1.8008 1.1016-3 1.1016s-2.1992-0.39844-3-1.1016l-9.1992-9.1992-0.89844 0.5c-3.3008 1.8008-6.8984 2.8008-10.602 2.8008-12.102 0-21.898-9.8008-21.898-21.898 0-12.102 9.8008-21.898 21.898-21.898 12.102 0 21.898 9.8008 21.898 21.898 0 4.3008-1.1992 8.3984-3.6016 12l-0.60156 1 9.1016 9.1016c0.69922 0.80078 1.1992 1.8008 1.1992 2.8984-0.097656 0.99609-0.49609 1.9961-1.2969 2.7969z"})]})})}),(0,t.jsx)("h1",{className:"!text-3xl font-bold leading-none !p-0",children:"Search Query Tracker"})]}),(0,t.jsx)(s.Button,{variant:"secondary",onClick:e,children:"Settings"})]}),r=({searchQueries:a,searchClicks:r,maxCount:c,onRowClick:n})=>{const[l,i]=(0,e.useState)({}),[o,d]=(0,e.useState)(""),[h,u]=(0,e.useState)("search"),[x,m]=(0,e.useState)("desc");(0,e.useEffect)((()=>{const e=Object.entries(a).reduce(((e,[s,t])=>(s.toLowerCase().includes(o.toLowerCase())&&(e[s]=t),e)),{}),s=w(e,r,h,x);i(s)}),[a,r,o,h,x]);const j=e=>{h===e?m("desc"===x?"asc":"desc"):(u(e),m("desc"))},p=e=>h!==e?null:"desc"===x?"▼":"▲",k=e=>r[e]?Object.values(r[e]).reduce(((e,s)=>e+s),0):0,w=(e,s,t,a)=>{const r=Object.entries(e);return r.sort((([e,s],[r,c])=>{let n=0;switch(t){case"search":default:n=c-s;break;case"term":n=e.localeCompare(r);break;case"clicks":const t=k(e);n=k(r)-t}return"asc"===a?-n:n})),Object.fromEntries(r)};return(0,t.jsxs)("div",{className:"sqt-table-container",children:[(0,t.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,t.jsx)(s.SearchControl,{value:o,onChange:d,placeholder:"Search terms...",label:"Search",hideLabelFromVision:!0,className:"w-[400px] mx-8 my-4"}),o&&(0,t.jsxs)("div",{className:"sqt-search-info",children:["Showing results for: ",(0,t.jsx)("strong",{children:o}),"(",Object.keys(l).length," results)"]})]}),(Object.keys(l).length>0||!o)&&(0,t.jsxs)("table",{className:"sqt-queries-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"w-[160px] !px-8",children:(0,t.jsxs)("button",{className:"sqt-sort-button",onClick:()=>j("search"),children:["Search ",p("search")]})}),(0,t.jsx)("th",{children:(0,t.jsxs)("button",{className:"sqt-sort-button",onClick:()=>j("term"),children:["Term ",p("term")]})}),(0,t.jsx)("th",{className:"w-[120px]",children:(0,t.jsxs)("button",{className:"sqt-sort-button",onClick:()=>j("clicks"),children:["Clicks ",p("clicks")]})})]})}),(0,t.jsx)("tbody",{children:Object.entries(l).map((([e,s])=>{const a=((e,s)=>{const t=c>0?s/c*100:0,a=k(e);return{percentage:t,hasClicks:a>0,totalClicks:a}})(e,s);return(0,t.jsxs)("tr",{className:a.hasClicks?"sqt-row-clickable":"",onClick:a.hasClicks?()=>n(e):void 0,style:{cursor:a.hasClicks?"pointer":"default"},children:[(0,t.jsx)("td",{className:"!px-8",children:s}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"sqt-bar-chart",children:[(0,t.jsx)("div",{className:"sqt-bar",style:{width:`${a.percentage}%`}}),(0,t.jsx)("div",{className:"sqt-bar-label",children:(0,t.jsx)("span",{children:e})})]})}),(0,t.jsxs)("td",{children:[a.totalClicks,a.hasClicks&&(0,t.jsx)("span",{className:"view-links",children:"View →"})]})]},e)}))})]})]})},c=window.wp.i18n,n=({isOpen:a,onClose:r,onReset:n})=>{const[l,i]=(0,e.useState)(""),[o,d]=(0,e.useState)(!0);return(0,e.useEffect)((()=>{d("reset"!==l.toLowerCase())}),[l]),a?(0,t.jsxs)(s.Modal,{title:(0,c.__)("Plugin Settings","search-query-tracker"),onRequestClose:r,className:"sqt-modal",size:"large",children:[(0,t.jsxs)("div",{className:"sqt-settings-section",children:[(0,t.jsx)("h1",{children:(0,c.__)("Troubleshooting","search-query-tracker")}),(0,t.jsxs)("p",{children:[(0,c.__)("To make things simple we have hardcoded search trigger. Add class","search-query-tracker")," ",(0,t.jsx)("code",{children:".search-result-item"})," ",(0,c.__)("to the search result item.","search-query-tracker")]}),(0,t.jsx)("p",{children:(0,c.__)("This will check for every a inside wrapper .search-result-item.","search-query-tracker")})]}),(0,t.jsxs)("div",{className:"sqt-settings-section mt-4 flex flex-col gap-4",children:[(0,t.jsx)("h1",{children:(0,c.__)("Clear All Data","search-query-tracker")}),(0,t.jsx)(s.Notice,{isDismissible:!1,politeness:"assertive",status:"warning",children:(0,c.__)("This will permanently delete all search query data and click tracking information. This action cannot be undone.","search-query-tracker")}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"reset"===l.toLowerCase()&&(n(),i(""))},className:"sqt-reset-confirmation flex gap-4 items-end",children:[(0,t.jsx)(s.__experimentalInputControl,{label:(0,c.__)('Type "reset" to confirm:',"search-query-tracker"),id:"reset-confirmation",value:l,onChange:i,placeholder:(0,c.__)("reset","search-query-tracker"),className:"w-full"}),(0,t.jsx)(s.Button,{isDestructive:!0,isDanger:!0,type:"submit",disabled:o,size:"compact",className:"text-nowrap",children:(0,c.__)("Clear All Data","search-query-tracker")})]})]})]}):null},l=({query:a,clickData:r,onClose:n})=>{const l=Object.entries(r||{}).map((([e,s])=>({url:e,count:s}))).sort(((e,s)=>s.count-e.count)),[i,o]=(0,e.useState)(!1),[d,h]=(0,e.useState)(!0),u=(0,e.useRef)(null);(0,e.useEffect)((()=>{const e=setTimeout((()=>{o(!0)}),10);return()=>clearTimeout(e)}),[]);const x=()=>{o(!1),setTimeout((()=>{h(!1),setTimeout((()=>{n()}),50)}),300)};return(0,e.useEffect)((()=>{const e=e=>{"Escape"===e.key&&x()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[]),d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"sqt-slide-overlay "+(i?"sqt-slide-overlay-visible":""),onClick:x}),(0,t.jsxs)("div",{ref:u,className:"sqt-slide-panel "+(i?"sqt-slide-panel-open":""),children:[(0,t.jsxs)("div",{className:"p-4 flex justify-between items-center",children:[(0,t.jsxs)("h2",{className:"!m-0",children:[(0,c.__)("Search term:","search-query-tracker")," ",a]}),(0,t.jsx)(s.Button,{icon:"no-alt",onClick:x,className:"sqt-slide-panel-close",label:(0,c.__)("Close panel","search-query-tracker"),showTooltip:!0})]}),(0,t.jsx)("div",{className:"sqt-slide-panel-content",children:l.length>0?(0,t.jsxs)("table",{className:"sqt-clicks-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"!px-4",children:(0,c.__)("URL","search-query-tracker")}),(0,t.jsx)("th",{children:(0,c.__)("Clicks","search-query-tracker")})]})}),(0,t.jsx)("tbody",{children:l.map((({url:e,count:s})=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"!px-4",children:(0,t.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:e})}),(0,t.jsx)("td",{children:s})]},e)))})]}):(0,t.jsx)("div",{className:"sqt-no-clicks",children:(0,t.jsx)("p",{children:(0,c.__)("No click data available for this search query.","search-query-tracker")})})})]})]}):null},i=()=>{const[s,c]=(0,e.useState)({}),[i,o]=(0,e.useState)({}),[d,h]=(0,e.useState)(0),[u,x]=(0,e.useState)(!0),[m,j]=(0,e.useState)(null),[p,k]=(0,e.useState)(null),[w,b]=(0,e.useState)("");(0,e.useEffect)((()=>{(async()=>{try{x(!0);const e=await(async()=>{try{const e=await fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"sqt_get_data",nonce:sqtData.nonce})});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const s=await e.json();if(s.success)return{searchQueries:s.data.searchQueries||{},searchClicks:s.data.searchClicks||{}};throw new Error(s.data||"Failed to fetch search data")}catch(e){throw console.error("Error fetching search data:",e),e}})();c(e.searchQueries||{}),o(e.searchClicks||{});let s=0;Object.values(e.searchQueries||{}).forEach((e=>{e>s&&(s=e)})),h(s),x(!1)}catch(e){j("Failed to load search data"),x(!1),console.error(e)}})()}),[]);const y=(e,s="")=>{k(e),s&&b(s)},q=()=>{k(null),b("")};return u&&0===Object.keys(s).length?(0,t.jsx)("div",{className:"sqt-loading",children:(0,t.jsx)("p",{children:"Loading search data..."})}):m?(0,t.jsx)("div",{className:"sqt-error",children:(0,t.jsx)("p",{children:m})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a,{onSettingsClick:()=>y("settings")}),0===Object.keys(s).length?(0,t.jsx)("div",{className:"sqt-no-data",children:(0,t.jsx)("p",{children:"No search queries data available yet."})}):(0,t.jsx)(r,{searchQueries:s,searchClicks:i,maxCount:d,onRowClick:e=>y("clicks",e)}),(0,t.jsx)(n,{isOpen:"settings"===p,onClose:q,onReset:async()=>{try{x(!0),await fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"sqt_reset_data",nonce:sqtData.nonce})}),c({}),o({}),h(0),q(),x(!1)}catch(e){j("Failed to reset data"),x(!1),console.error(e)}}}),"clicks"===p&&(0,t.jsx)(l,{onClose:q,query:w,clickData:i[w]||{}})]})};document.addEventListener("DOMContentLoaded",(()=>{const s=document.getElementById("sqt-app");s&&(0,e.render)((0,t.jsx)(i,{}),s)}))})();